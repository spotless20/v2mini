[include Bed_Heater.cfg]
[include Bed_Leveling.cfg]
[include Bourd_EXP_Pins.cfg]
[include Extruder.cfg]
[include fans.cfg]
[include leds.cfg]
[include macros.cfg]
[include mainsail.cfg]
#[include sensorless.cfg]
[include speedtest.cfg]
[include stepperXY.cfg]
[include stepperZ.cfg]
[include tempsensor.cfg]
[include timelapse.cfg]
[include KAMP/*cfg]
[include bedfans.cfg]

#[include adxl.cfg]


[mcu] 
serial: /dev/serial/by-id/usb-Klipper_stm32f429xx_2F003D000D50304738313820-if00
restart_method: command


[mcu EBB]
canbus_uuid: 265f406d1861


[adxl345]
cs_pin: EBB:PB12
spi_software_sclk_pin: EBB:PB10
spi_software_mosi_pin: EBB:PB11
spi_software_miso_pin: EBB:PB2
axes_map: x,y,z

[resonance_tester]
accel_chip: adxl345
probe_points:
    90,90,20 

[printer]
kinematics: corexy
max_velocity: 300  
max_accel: 20000		
max_z_velocity: 25 			
max_z_accel: 350
square_corner_velocity: 5.0

[input_shaper]

[idle_timeout]
timeout: 18000

[force_move]
enable_force_move: true

[exclude_object]

[pause_resume]
recover_velocity: 300.0

[safe_z_home]
home_xy_position:90,110
speed:200
z_hop:10

[respond]
default_type: echo
default_prefix:

[probe]
pin: EBB:PB8
x_offset: 0.0   
y_offset: 0.0
#z_offset: 9.5    
speed: 20.0
samples: 1
samples_result: median
sample_retract_dist: 5.0
samples_tolerance: 0.008
samples_tolerance_retries: 1
activate_gcode:
    {% set PROBE_TEMP = 150 %}
    {% set MAX_TEMP = PROBE_TEMP + 5 %}
    {% set ACTUAL_TEMP = printer.extruder.temperature %}
    {% set TARGET_TEMP = printer.extruder.target %}

    {% if TARGET_TEMP > PROBE_TEMP %}
        { action_respond_info('Extruder temperature target of %.1fC is too high, lowering to %.1fC' % (TARGET_TEMP, PROBE_TEMP)) }
        M109 S{ PROBE_TEMP }
    {% else %}
        # Temperature target is already low enough, but nozzle may still be too hot.
        {% if ACTUAL_TEMP > MAX_TEMP %}
            { action_respond_info('Extruder temperature %.1fC is still too high, waiting until below %.1fC' % (ACTUAL_TEMP, MAX_TEMP)) }
            TEMPERATURE_WAIT SENSOR=extruder MAXIMUM={ MAX_TEMP }
        {% endif %}
    {% endif %}

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [stepper_z]
#*# position_endstop = 1.513
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.070833, -0.025000, -0.017708, -0.011458, -0.021875
#*# 	  -0.041667, -0.014583, -0.008333, 0.045833, -0.022917
#*# 	  -0.034375, -0.005208, 0.000000, 0.001042, -0.046875
#*# 	  -0.032292, -0.000000, 0.009375, -0.004167, -0.040625
#*# 	  -0.036458, -0.001042, 0.012500, -0.004167, -0.044792
#*# tension = 0.2
#*# min_x = 7.23
#*# algo = lagrange
#*# y_count = 5
#*# mesh_y_pps = 2
#*# min_y = 8.23
#*# x_count = 5
#*# max_y = 174.87
#*# mesh_x_pps = 2
#*# max_x = 171.31
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 54.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 41.0
#*#
#*# [probe]
#*# z_offset = -0.635
